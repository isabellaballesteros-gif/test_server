<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Server</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .chat-header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .chat-header .status {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .username-setup {
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
        }
        
        .username-setup input {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 1em;
            width: 250px;
            margin-right: 10px;
        }
        
        .username-setup button {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .username-setup button:hover {
            transform: scale(1.05);
        }
        
        .avatar-section {
            margin: 15px 0;
        }
        
        .avatar-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            display: block;
        }
        
        .selected-avatar {
            font-size: 2.5em;
            margin: 10px 0;
            display: inline-block;
            padding: 10px;
            background: white;
            border-radius: 50%;
            border: 3px solid #667eea;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .selected-avatar:hover {
            transform: scale(1.1);
        }
        
        .avatar-selector {
            display: none;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px auto;
            border: 2px solid #667eea;
            max-width: 500px;
        }
        
        .avatar-selector.show {
            display: block;
        }
        
        .avatar-category {
            margin-bottom: 15px;
        }
        
        .avatar-category-title {
            font-size: 0.85em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            text-align: left;
        }
        
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .avatar-emoji {
            font-size: 1.8em;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.2s;
            text-align: center;
            background: #f8f9fa;
        }
        
        .avatar-emoji:hover {
            background: #667eea;
            transform: scale(1.2);
        }
        
        .message-avatar {
            font-size: 1.5em;
            margin-right: 8px;
            display: inline-block;
            vertical-align: middle;
            line-height: 1;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Android Emoji", "EmojiSymbols", "EmojiOne Mozilla", "Twemoji Mozilla", "Segoe UI Symbol", sans-serif;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .message-username {
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
            display: flex;
            align-items: center;
        }
        
        .message-time {
            font-size: 0.8em;
            color: #999;
        }
        
        .message-content {
            background: white;
            padding: 12px 15px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }
        
        .typing-indicator {
            padding: 10px 20px;
            font-style: italic;
            color: #999;
            font-size: 0.9em;
        }
        
        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 2px solid #f0f0f0;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
        }
        
        .chat-input-container input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .chat-input-container input:focus {
            border-color: #667eea;
        }
        
        .chat-input-container button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .chat-input-container button:hover {
            transform: scale(1.05);
        }
        
        .chat-input-container button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        .connected-users {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .theme-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .theme-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .theme-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .theme-dropdown {
            position: absolute;
            top: 40px;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            min-width: 180px;
            display: none;
            overflow: hidden;
        }
        
        .theme-dropdown.show {
            display: block;
        }
        
        .theme-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .theme-option:last-child {
            border-bottom: none;
        }
        
        .theme-option:hover {
            background: #f8f9fa;
        }
        
        /* Theme Styles */
        body.theme-default {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        body.theme-blackwhite {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 50%, #4a4a4a 100%);
        }
        
        body.theme-blackwhite .chat-container {
            background: #ffffff;
            border: 2px solid #000000;
        }
        
        body.theme-blackwhite .chat-header {
            background: linear-gradient(135deg, #000000 0%, #2c2c2c 100%);
        }
        
        body.theme-blackwhite .message-content {
            background: #f5f5f5;
            border: 1px solid #000000;
            color: #000000;
        }
        
        body.theme-neon {
            background: linear-gradient(45deg, 
                #ff006e 0%, 
                #fb5607 14%, 
                #ffbe0b 28%, 
                #8338ec 42%, 
                #3a86ff 56%, 
                #06ffa5 70%, 
                #ff006e 84%, 
                #fb5607 100%);
            background-size: 400% 400%;
            animation: neonShift 10s ease infinite;
        }
        
        @keyframes neonShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        body.theme-neon .chat-container {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }
        
        body.theme-neon .chat-header {
            background: linear-gradient(135deg, #ff006e 0%, #8338ec 100%);
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.8);
        }
        
        body.theme-neon .message-username {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
        
        body.theme-neon .message-content {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        body.theme-cats {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            background-image: 
                url('https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=200&h=200&fit=crop'),
                url('https://images.unsplash.com/photo-1574158622682-e40e69881006?w=200&h=200&fit=crop'),
                url('https://images.unsplash.com/photo-1518791841217-8f162f1e1131?w=200&h=200&fit=crop');
            background-size: 150px 150px, 120px 120px, 180px 180px;
            background-position: 0% 0%, 50% 50%, 100% 100%;
            background-repeat: no-repeat;
            animation: catFloat 20s ease-in-out infinite;
        }
        
        @keyframes catFloat {
            0%, 100% { background-position: 0% 0%, 50% 50%, 100% 100%; }
            50% { background-position: 100% 100%, 0% 0%, 50% 50%; }
        }
        
        body.theme-cats .chat-container {
            background: rgba(255, 253, 245, 0.95);
            border: 3px solid #ff8c42;
        }
        
        body.theme-cats .chat-header {
            background: linear-gradient(135deg, #ff8c42 0%, #ff6b6b 100%);
        }
        
        body.theme-cats .message-username {
            color: #ff8c42;
        }
        
        body.theme-dogs {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            background-image: 
                url('https://images.unsplash.com/photo-1552053831-71594a27632d?w=200&h=200&fit=crop'),
                url('https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=200&h=200&fit=crop'),
                url('https://images.unsplash.com/photo-1537151608828-ea2b11777ee8?w=200&h=200&fit=crop');
            background-size: 160px 160px, 140px 140px, 170px 170px;
            background-position: 10% 10%, 60% 60%, 90% 90%;
            background-repeat: no-repeat;
            animation: dogFloat 25s ease-in-out infinite;
        }
        
        @keyframes dogFloat {
            0%, 100% { background-position: 10% 10%, 60% 60%, 90% 90%; }
            50% { background-position: 90% 90%, 10% 10%, 60% 60%; }
        }
        
        body.theme-dogs .chat-container {
            background: rgba(255, 248, 240, 0.95);
            border: 3px solid #8b4513;
        }
        
        body.theme-dogs .chat-header {
            background: linear-gradient(135deg, #8b4513 0%, #cd853f 100%);
        }
        
        body.theme-dogs .message-username {
            color: #8b4513;
        }
        
        body.theme-thanksgiving {
            background: linear-gradient(135deg, #d2691e 0%, #8b4513 50%, #daa520 100%);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 140, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 69, 19, 0.3) 0%, transparent 50%);
        }
        
        body.theme-thanksgiving .chat-container {
            background: rgba(255, 248, 240, 0.95);
            border: 3px solid #8b4513;
        }
        
        body.theme-thanksgiving .chat-header {
            background: linear-gradient(135deg, #d2691e 0%, #8b4513 100%);
        }
        
        body.theme-thanksgiving .message-username {
            color: #d2691e;
        }
        
        body.theme-thanksgiving .message-content {
            background: #fff8f0;
            border: 1px solid #daa520;
        }
        
        body.theme-christmas {
            background: linear-gradient(135deg, #dc143c 0%, #228b22 50%, #ffffff 100%);
            background-image: 
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 70% 80%, rgba(220, 20, 60, 0.2) 0%, transparent 40%);
            animation: christmasTwinkle 3s ease-in-out infinite;
        }
        
        @keyframes christmasTwinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.95; }
        }
        
        body.theme-christmas .chat-container {
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #dc143c;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);
        }
        
        body.theme-christmas .chat-header {
            background: linear-gradient(135deg, #dc143c 0%, #228b22 100%);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
        }
        
        body.theme-christmas .message-username {
            color: #dc143c;
        }
        
        body.theme-christmas .message-content {
            background: #fff;
            border: 2px solid #228b22;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header" style="position: relative;">
            <div class="theme-selector">
                <button class="theme-button" onclick="toggleThemeDropdown()">üé® Themes</button>
                <div class="theme-dropdown" id="themeDropdown">
                    <div class="theme-option" onclick="changeTheme('default')">Default</div>
                    <div class="theme-option" onclick="changeTheme('blackwhite')">Black & White</div>
                    <div class="theme-option" onclick="changeTheme('neon')">Neon Rainbow</div>
                    <div class="theme-option" onclick="changeTheme('cats')">üê± Cats</div>
                    <div class="theme-option" onclick="changeTheme('dogs')">üê∂ Dogs</div>
                    <div class="theme-option" onclick="changeTheme('thanksgiving')">ü¶É Thanksgiving</div>
                    <div class="theme-option" onclick="changeTheme('christmas')">üéÑ Christmas</div>
                </div>
            </div>
            <h1>üí¨ Chat Server</h1>
            <div class="status" id="connectionStatus">Connecting...</div>
            <div class="connected-users" id="userCount"></div>
        </div>
        
        <div class="username-setup" id="usernameSetup">
            <input type="text" id="usernameInput" placeholder="Enter your username" maxlength="20">
            <div class="avatar-section">
                <label class="avatar-label">Choose your avatar:</label>
                <div class="selected-avatar" id="selectedAvatar" onclick="toggleAvatarSelector()">üë§</div>
                <div class="avatar-selector" id="avatarSelector">
                    <div class="avatar-category">
                        <div class="avatar-category-title">üòÄ Smileys & People</div>
                        <div class="avatar-grid" id="smileys"></div>
                    </div>
                    <div class="avatar-category">
                        <div class="avatar-category-title">üê∂ Animals & Nature</div>
                        <div class="avatar-grid" id="animals"></div>
                    </div>
                    <div class="avatar-category">
                        <div class="avatar-category-title">üçï Food & Drink</div>
                        <div class="avatar-grid" id="food"></div>
                    </div>
                    <div class="avatar-category">
                        <div class="avatar-category-title">‚öΩ Activities & Sports</div>
                        <div class="avatar-grid" id="activities"></div>
                    </div>
                    <div class="avatar-category">
                        <div class="avatar-category-title">üöó Travel & Places</div>
                        <div class="avatar-grid" id="travel"></div>
                    </div>
                    <div class="avatar-category">
                        <div class="avatar-category-title">üíé Objects & Symbols</div>
                        <div class="avatar-grid" id="objects"></div>
                    </div>
                    <div class="avatar-category">
                        <div class="avatar-category-title">üé® Flags & More</div>
                        <div class="avatar-grid" id="flags"></div>
                    </div>
                </div>
            </div>
            <button onclick="setUsername()">Join Chat</button>
        </div>
        
        <div class="chat-messages" id="chatMessages"></div>
        
        <div class="chat-input-area hidden" id="chatInputArea">
            <div class="chat-input-container">
                <input type="text" id="messageInput" placeholder="Type your message..." maxlength="500">
                <button onclick="sendMessage()" id="sendButton">Send</button>
            </div>
        </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Initialize variables first
        let username = '';
        let selectedAvatar = 'üë§';
        let typingTimeout;
        let socket = null;
        
        // Initialize Socket.IO after the script loads
        function initializeSocket() {
            if (typeof io !== 'undefined') {
                socket = io();
                setupSocketListeners();
                
                // Also set up listeners immediately in case socket connects quickly
                socket.on('connect', () => {
                    setupMessageInputListeners();
                });
            } else {
                // Retry if Socket.IO hasn't loaded yet
                setTimeout(initializeSocket, 100);
            }
        }
        
        // Setup socket event listeners
        function setupSocketListeners() {
            if (!socket) return;
            
            // Connection status
            socket.on('connect', () => {
                const statusEl = document.getElementById('connectionStatus');
                if (statusEl) {
                    statusEl.textContent = '‚úì Connected';
                    statusEl.style.color = '#90EE90';
                }
            });
            
            socket.on('disconnect', () => {
                const statusEl = document.getElementById('connectionStatus');
                if (statusEl) {
                    statusEl.textContent = '‚úó Disconnected';
                    statusEl.style.color = '#ff6b6b';
                }
            });
            
            // Load message history
            socket.on('messageHistory', (messages) => {
                messages.forEach(msg => displayMessage(msg));
                scrollToBottom();
            });
            
            // Receive new messages
            socket.on('newMessage', (message) => {
                displayMessage(message);
                scrollToBottom();
            });
            
            // Typing indicator
            socket.on('userTyping', (data) => {
                let typingDiv = document.getElementById('typingIndicator');
                if (!typingDiv) {
                    typingDiv = document.createElement('div');
                    typingDiv.id = 'typingIndicator';
                    typingDiv.className = 'typing-indicator';
                    const messagesDiv = document.getElementById('chatMessages');
                    if (messagesDiv) {
                        messagesDiv.appendChild(typingDiv);
                    }
                }
                
                if (data.isTyping) {
                    typingDiv.textContent = `${data.username} is typing...`;
                } else {
                    typingDiv.remove();
                }
            });
        }
        
        // Setup message input event listeners
        function setupMessageInputListeners() {
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                // Remove any existing listeners by cloning the element
                const newInput = messageInput.cloneNode(true);
                messageInput.parentNode.replaceChild(newInput, messageInput);
                
                // Add event listeners
                newInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    } else {
                        if (socket && socket.connected && username) {
                            try {
                                socket.emit('typing', { username: username, isTyping: true });
                                clearTimeout(typingTimeout);
                                typingTimeout = setTimeout(() => {
                                    if (socket && socket.connected && username) {
                                        socket.emit('typing', { username: username, isTyping: false });
                                    }
                                }, 1000);
                            } catch (error) {
                                console.error('Error sending typing indicator:', error);
                            }
                        }
                    }
                });
            }
        }
        
        // Start Socket.IO initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSocket);
        } else {
            initializeSocket();
        }
        
        // Emoji collections
        const emojiCategories = {
            smileys: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'ü§£', 'üòÇ', 'üôÇ', 'üôÉ', 'üòâ', 'üòä', 'üòá', 'ü•∞', 'üòç', 'ü§©', 'üòò', 'üòó', 'üòö', 'üòô', 'üòã', 'üòõ', 'üòú', 'ü§™', 'üòù', 'ü§ë', 'ü§ó', 'ü§≠', 'ü§´', 'ü§î', 'ü§ê', 'ü§®', 'üòê', 'üòë', 'üò∂', 'üòè', 'üòí', 'üôÑ', 'üò¨', 'ü§•', 'üòå', 'üòî', 'üò™', 'ü§§', 'üò¥', 'üò∑', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß', 'ü•µ', 'ü•∂', 'üòµ', 'ü§Ø', 'ü§†', 'ü•≥', 'üòé', 'ü§ì', 'üßê', 'üë∂', 'üëß', 'üßí', 'üë¶', 'üë©', 'üßë', 'üë®', 'üëµ', 'üßì', 'üë¥', 'üëÆ', 'üë∑', 'üíÇ', 'üïµÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äçüåæ', 'üë®‚Äçüåæ', 'üë©‚Äçüç≥', 'üë®‚Äçüç≥', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüé§', 'üë®‚Äçüé§', 'üë©‚Äçüè´', 'üë®‚Äçüè´', 'üë©‚Äçüè≠', 'üë®‚Äçüè≠', 'üë©‚Äçüíª', 'üë®‚Äçüíª', 'üë©‚Äçüíº', 'üë®‚Äçüíº', 'üë©‚Äçüîß', 'üë®‚Äçüîß', 'üë©‚Äçüî¨', 'üë®‚Äçüî¨', 'üë©‚Äçüé®', 'üë®‚Äçüé®', 'üë©‚Äçüöí', 'üë®‚Äçüöí', 'üë©‚Äç‚úàÔ∏è', 'üë®‚Äç‚úàÔ∏è', 'üë©‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üë©‚Äç‚öñÔ∏è', 'üë®‚Äç‚öñÔ∏è', 'ü§∂', 'üéÖ', 'üë∏', 'ü§¥', 'üë∞', 'ü§µ', 'üëº', 'ü§∞', 'üôá', 'üôÖ', 'üôÜ', 'üôã', 'ü§¶', 'ü§∑', 'üôé', 'üôç', 'üíá', 'üíÜ', 'üßñ', 'üßó', 'üèÉ', 'üèÉ‚Äç‚ôÄÔ∏è', 'üèÉ‚Äç‚ôÇÔ∏è', 'üö∂', 'üö∂‚Äç‚ôÄÔ∏è', 'üö∂‚Äç‚ôÇÔ∏è', 'üíÉ', 'üï∫', 'üï¥Ô∏è', 'üëØ', 'üëØ‚Äç‚ôÄÔ∏è', 'üëØ‚Äç‚ôÇÔ∏è', 'üßò', 'üßò‚Äç‚ôÄÔ∏è', 'üßò‚Äç‚ôÇÔ∏è', 'üõÄ', 'üõå', 'üë≠', 'üë´', 'üë¨', 'üíè', 'üíë', 'üë™', 'üë®‚Äçüë©‚Äçüëß', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë®‚Äçüë©‚Äçüë¶‚Äçüë¶', 'üë®‚Äçüë©‚Äçüëß‚Äçüëß', 'üë©‚Äçüë©‚Äçüë¶', 'üë©‚Äçüë©‚Äçüëß', 'üë©‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë©‚Äçüë©‚Äçüë¶‚Äçüë¶', 'üë©‚Äçüë©‚Äçüëß‚Äçüëß', 'üë®‚Äçüë®‚Äçüë¶', 'üë®‚Äçüë®‚Äçüëß', 'üë®‚Äçüë®‚Äçüëß‚Äçüë¶', 'üë®‚Äçüë®‚Äçüë¶‚Äçüë¶', 'üë®‚Äçüë®‚Äçüëß‚Äçüëß', 'üë©‚Äçüë¶', 'üë©‚Äçüëß', 'üë©‚Äçüëß‚Äçüë¶', 'üë©‚Äçüë¶‚Äçüë¶', 'üë©‚Äçüëß‚Äçüëß', 'üë®‚Äçüë¶', 'üë®‚Äçüëß', 'üë®‚Äçüëß‚Äçüë¶', 'üë®‚Äçüë¶‚Äçüë¶', 'üë®‚Äçüëß‚Äçüëß', 'üëã', 'ü§ö', 'üñê', '‚úã', 'üññ', 'üëå', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', '‚òùÔ∏è', 'üëç', 'üëé', '‚úä', 'üëä', 'ü§õ', 'ü§ú', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è', 'üí™', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ', 'üß†', 'ü¶∑', 'ü¶¥', 'üëÄ', 'üëÅÔ∏è', 'üëÖ', 'üëÑ', 'üíã', 'üíò', 'üíù', 'üíñ', 'üíó', 'üíì', 'üíû', 'üíï', 'üíü', '‚ù£Ô∏è', 'üíî', '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíØ', 'üí¢', 'üí•', 'üí´', 'üí¶', 'üí®', 'üï≥Ô∏è', 'üí£', 'üí¨', 'üëÅÔ∏è‚Äçüó®Ô∏è', 'üó®Ô∏è', 'üóØÔ∏è', 'üí≠', 'üí§'],
            animals: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üêΩ', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú', 'ü¶ü', 'ü¶ó', 'üï∑Ô∏è', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã', 'ü¶à', 'üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'üêò', 'ü¶õ', 'ü¶è', 'üê™', 'üê´', 'ü¶í', 'ü¶ò', 'ü¶¨', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'üêñ', 'üêè', 'üêë', 'ü¶ô', 'üêê', 'ü¶å', 'üêï', 'üê©', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üêà', 'üêì', 'ü¶É', 'ü¶§', 'ü¶ö', 'ü¶ú', 'ü¶¢', 'ü¶©', 'üïäÔ∏è', 'üêá', 'ü¶ù', 'ü¶®', 'ü¶°', 'ü¶¶', 'ü¶•', 'üêÅ', 'üêÄ', 'üêøÔ∏è', 'ü¶î', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üå∂Ô∏è', 'üå∑', 'üå∫', 'üåª', 'üåº', 'üåΩ', 'üåæ', 'üåø', 'üçÄ', 'üçÅ', 'üçÇ', 'üçÉ', 'üçÑ', 'ü•Ä', 'üå∞', 'üå±', 'üåø', '‚òòÔ∏è', 'üçÄ', 'üçÉ', 'üåæ', 'üå∫', 'üåª', 'üåπ', 'üå∑', 'üåº', 'üå∏', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üåæ', 'üåø', '‚òòÔ∏è', 'üçÄ', 'üçÉ', 'üå±', 'üåø', 'üå≥', 'üå≤', 'üå¥', 'üåµ'],
            food: ['üçè', 'üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'üçà', 'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ', 'üçÜ', 'ü•ë', 'ü•¶', 'ü•¨', 'ü•í', 'üå∂Ô∏è', 'üåΩ', 'ü•ï', 'ü•î', 'üç†', 'ü•ê', 'ü•Ø', 'üçû', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ö', 'üç≥', 'ü•û', 'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üå≠', 'üçî', 'üçü', 'üçï', 'ü•™', 'ü•ô', 'üåÆ', 'üåØ', 'ü•ó', 'ü•ò', 'ü•´', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô', 'üçö', 'üçò', 'üç•', 'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üßÅ', 'üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üçø', 'üç©', 'üç™', 'üå∞', 'ü•ú', 'üçØ', 'ü•õ', 'üçº', '‚òïÔ∏è', 'üçµ', 'üßÉ', 'ü•§', 'üç∂', 'üç∫', 'üçª', 'ü•Ç', 'üç∑', 'ü•É', 'üç∏', 'üçπ', 'üßâ', 'üçæ', 'üßä'],
            activities: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'üèì', 'üè∏', 'ü•Ö', 'üèí', 'üèë', 'üèè', 'ü•ç', 'üèπ', 'üé£', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõ∑', '‚õ∏Ô∏è', 'ü•å', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'üèãÔ∏è', 'ü§º', 'ü§∏', 'ü§∫', '‚õπÔ∏è', 'ü§æ', 'üèåÔ∏è', 'üèá', 'üßò', 'üèÑ', 'üèä', 'ü§Ω', 'üö£', 'üßó', 'üöµ', 'üö¥', 'üèÜ', 'ü•á', 'ü•à', 'ü•â', 'üèÖ', 'üéñÔ∏è', 'üèµÔ∏è', 'üéóÔ∏è', 'üé´', 'üéüÔ∏è', 'üé™', 'ü§π', 'üé≠', 'ü©∞', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'üé≤', '‚ôüÔ∏è', 'üéØ', 'üé≥', 'üéÆ', 'üé∞', 'üß©', 'üÉè', 'üÄÑ', 'üé¥'],
            travel: ['üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèéÔ∏è', 'üöì', 'üöë', 'üöí', 'üöê', 'üöö', 'üöõ', 'üöú', 'üõ¥', 'üö≤', 'üõµ', 'üèçÔ∏è', 'üõ∫', 'üö®', 'üöî', 'üöç', 'üöò', 'üöñ', 'üö°', 'üö†', 'üöü', 'üöÉ', 'üöã', 'üöû', 'üöù', 'üöÑ', 'üöÖ', 'üöà', 'üöÇ', 'üöÜ', 'üöá', 'üöä', 'üöâ', '‚úàÔ∏è', 'üõ´', 'üõ¨', 'üõ©Ô∏è', 'üí∫', 'üöÅ', 'üöü', 'üö†', 'üö°', 'üõ∞Ô∏è', 'üöÄ', 'üõ∏', '‚öì', '‚õµ', 'üõ•Ô∏è', 'üõ≥Ô∏è', '‚õ¥Ô∏è', 'üö§', 'üõ∂', 'üö£', 'üßó', 'üèîÔ∏è', '‚õ∞Ô∏è', 'üåã', 'üóª', 'üèïÔ∏è', 'üèñÔ∏è', 'üèúÔ∏è', 'üèùÔ∏è', 'üèûÔ∏è', 'üèüÔ∏è', 'üèõÔ∏è', 'üèóÔ∏è', 'üß±', 'üèòÔ∏è', 'üèöÔ∏è', 'üè†', 'üè°', 'üè¢', 'üè£', 'üè§', 'üè•', 'üè¶', 'üè®', 'üè©', 'üè™', 'üè´', 'üè¨', 'üè≠', 'üèØ', 'üè∞', 'üóº', 'üóΩ', '‚õ™', 'üïå', 'üõï', 'üïç', '‚õ©Ô∏è', 'üïã', '‚õ≤', '‚õ∫', 'üåÅ', 'üåÉ', 'üèôÔ∏è', 'üåÑ', 'üåÖ', 'üåÜ', 'üåá', 'üåâ', '‚ô®Ô∏è', 'üé†', 'üé°', 'üé¢', 'üíà', 'üé™', 'üöÇ', 'üöÉ', 'üöÑ', 'üöÖ', 'üöÜ', 'üöá', 'üöà', 'üöâ', 'üöä', 'üöù', 'üöû', 'üöã', 'üöå', 'üöç', 'üöé', 'üöê', 'üöë', 'üöí', 'üöì', 'üöî', 'üöï', 'üöñ', 'üöó', 'üöò', 'üöô', 'üöö', 'üöõ', 'üöú', 'üèéÔ∏è', 'üèçÔ∏è', 'üõµ', 'üö®', 'üöî', 'üöç', 'üöò', 'üöñ', 'üö°', 'üö†', 'üöü', 'üöÉ', 'üöã', 'üöû', 'üöù', 'üöÑ', 'üöÖ', 'üöà', 'üöÇ', 'üöÜ', 'üöá', 'üöä', 'üöâ'],
            objects: ['‚åö', 'üì±', 'üì≤', 'üíª', '‚å®Ô∏è', 'üñ•Ô∏è', 'üñ®Ô∏è', 'üñ±Ô∏è', 'üñ≤Ô∏è', 'üïπÔ∏è', 'üóúÔ∏è', 'üíæ', 'üíø', 'üìÄ', 'üìº', 'üì∑', 'üì∏', 'üìπ', 'üé•', 'üìΩÔ∏è', 'üéûÔ∏è', 'üìû', '‚òéÔ∏è', 'üìü', 'üì†', 'üì∫', 'üìª', 'üéôÔ∏è', 'üéöÔ∏è', 'üéõÔ∏è', '‚è±Ô∏è', '‚è≤Ô∏è', '‚è∞', 'üï∞Ô∏è', '‚åõ', '‚è≥', 'üì°', 'üîã', 'üîå', 'üí°', 'üî¶', 'üïØÔ∏è', 'üßØ', 'üõ¢Ô∏è', 'üí∏', 'üíµ', 'üí¥', 'üí∂', 'üí∑', 'üí∞', 'üí≥', 'üíé', '‚öñÔ∏è', 'üß∞', 'üîß', 'üî®', '‚öíÔ∏è', 'üõ†Ô∏è', '‚õèÔ∏è', 'üî©', '‚öôÔ∏è', 'üß±', '‚õìÔ∏è', 'üß≤', 'üî´', 'üí£', 'üß®', 'üî™', 'üó°Ô∏è', '‚öîÔ∏è', 'üõ°Ô∏è', 'üö¨', '‚ö∞Ô∏è', '‚ö±Ô∏è', 'üè∫', 'üîÆ', 'üìø', 'üßø', 'üíà', '‚öóÔ∏è', 'üî≠', 'üî¨', 'üï≥Ô∏è', 'ü©π', 'ü©∫', 'üíä', 'üíâ', 'üß¨', 'ü¶†', 'üß´', 'üß™', 'üå°Ô∏è', 'üßπ', 'üß∫', 'üßª', 'üöΩ', 'üöø', 'üõÅ', 'üõÄ', 'üßº', 'ü™í', 'üßΩ', 'üß¥', 'üõéÔ∏è', 'üîë', 'üóùÔ∏è', 'üö™', 'üõãÔ∏è', 'üõèÔ∏è', 'üõå', 'üß∏', 'üñºÔ∏è', 'üõçÔ∏è', 'üõí', 'üéÅ', 'üéà', 'üéè', 'üéÄ', 'ü™Å', 'ü™Ä', 'üèÆ', 'üéä', 'üéâ', 'üéé', 'üéê', 'üéå', 'üèÆ', 'üßß', '‚úâÔ∏è', 'üì©', 'üì®', 'üìß', 'üíå', 'üì•', 'üì§', 'üì¶', 'üè∑Ô∏è', 'üì™', 'üì´', 'üì¨', 'üì≠', 'üìÆ', 'üìØ', 'üìú', 'üìÉ', 'üìÑ', 'üìë', 'üìä', 'üìà', 'üìâ', 'üóíÔ∏è', 'üóìÔ∏è', 'üìÜ', 'üìÖ', 'üóëÔ∏è', 'üìá', 'üóÉÔ∏è', 'üó≥Ô∏è', 'üóÑÔ∏è', 'üìã', 'üìÅ', 'üìÇ', 'üóÇÔ∏è', 'üìÖ', 'üìÜ', 'üóíÔ∏è', 'üóìÔ∏è', 'üìá', 'üìà', 'üìâ', 'üìä', 'üìã', 'üìå', 'üìç', 'üìé', 'üñáÔ∏è', 'üìè', 'üìê', '‚úÇÔ∏è', 'üóÉÔ∏è', 'üóÑÔ∏è', 'üóÇÔ∏è', 'üìí', 'üìì', 'üìî', 'üìï', 'üìñ', 'üìó', 'üìò', 'üìô', 'üìö', 'üìì', 'üìí', 'üìÉ', 'üìú', 'üì∞', 'üóûÔ∏è', 'üìÑ', 'üìë', 'üîñ', 'üè∑Ô∏è', 'üí∞', 'üí¥', 'üíµ', 'üí∂', 'üí∑', 'üí∏', 'üí≥', 'üßæ', 'üíπ', '‚úâÔ∏è', 'üìß', 'üì®', 'üì©', 'üì§', 'üì•', 'üì¶', 'üì´', 'üì™', 'üì¨', 'üì≠', 'üìÆ', 'üó≥Ô∏è', '‚úèÔ∏è', '‚úíÔ∏è', 'üñäÔ∏è', 'üñãÔ∏è', 'üñçÔ∏è', 'üñåÔ∏è', 'üñåÔ∏è', 'üñçÔ∏è', 'üñäÔ∏è', 'üñãÔ∏è', '‚úèÔ∏è', '‚úíÔ∏è', 'üìù', 'üíº', 'üìÅ', 'üìÇ', 'üóÇÔ∏è', 'üìÖ', 'üìÜ', 'üóíÔ∏è', 'üóìÔ∏è', 'üìá', 'üìà', 'üìâ', 'üìä', 'üìã', 'üìå', 'üìç', 'üìé', 'üñáÔ∏è', 'üìè', 'üìê', '‚úÇÔ∏è', 'üóÉÔ∏è', 'üóÑÔ∏è', 'üóëÔ∏è', 'üîí', 'üîì', 'üîè', 'üîê', 'üîë', 'üóùÔ∏è', 'üî®', 'ü™ì', '‚õèÔ∏è', '‚öíÔ∏è', 'üõ†Ô∏è', 'ü™ö', 'üîß', 'ü™õ', 'üî©', '‚öôÔ∏è', 'üß∞', 'üß≤', '‚õìÔ∏è', 'ü™ù', 'üßØ', 'üõ¢Ô∏è', 'üß¥', 'üßΩ', 'üßπ', 'ü™£', 'üß∫', 'ü™§', 'ü™Ä', 'ü™Å', 'üß∏', 'ü™Ü', 'ü™Ö', 'ü™°', 'üßµ', 'üß∂', 'üß∑', 'ü™¢', 'ü™°', 'üßµ', 'üß∂', 'üß∑', 'ü™¢', 'ü™ö', 'ü™õ', 'üî©', '‚öôÔ∏è', 'üß∞', 'üß≤', '‚õìÔ∏è', 'ü™ù', 'üßØ', 'üõ¢Ô∏è', 'üß¥', 'üßΩ', 'üßπ', 'ü™£', 'üß∫', 'ü™§', 'ü™Ä', 'ü™Å', 'üß∏', 'ü™Ü', 'ü™Ö', 'ü™°', 'üßµ', 'üß∂', 'üß∑', 'ü™¢'],
            flags: ['üè≥Ô∏è', 'üè¥', 'üèÅ', 'üö©', 'üè≥Ô∏è‚Äçüåà', 'üè≥Ô∏è‚Äç‚ößÔ∏è', 'üá∫üá≥', 'üá¶üá´', 'üá¶üáΩ', 'üá¶üá±', 'üá©üáø', 'üá¶üá∏', 'üá¶üá©', 'üá¶üá¥', 'üá¶üáÆ', 'üá¶üá∂', 'üá¶üá¨', 'üá¶üá∑', 'üá¶üá≤', 'üá¶üáº', 'üá¶üá∫', 'üá¶üáπ', 'üá¶üáø', 'üáßüá∏', 'üáßüá≠', 'üáßüá©', 'üáßüáß', 'üáßüáæ', 'üáßüá™', 'üáßüáø', 'üáßüáØ', 'üáßüá≤', 'üáßüáπ', 'üáßüá¥', 'üáßüá¶', 'üáßüáº', 'üáßüá∑', 'üáÆüá¥', 'üáªüá¨', 'üáßüá≥', 'üáßüá¨', 'üáßüá´', 'üáßüáÆ', 'üá∞üá≠', 'üá®üá≤', 'üá®üá¶', 'üáÆüá∂', 'üá®üáª', 'üá∞üáæ', 'üá®üá´', 'üáπüá©', 'üá®üá±', 'üá®üá≥', 'üá®üáΩ', 'üá®üá®', 'üá®üá¥', 'üá∞üá≤', 'üá®üá¨', 'üá®üá©', 'üá®üá∞', 'üá®üá∑', 'üá≠üá∑', 'üá®üá∫', 'üá®üáº', 'üá®üáæ', 'üá®üáø', 'üá©üá∞', 'üá©üáØ', 'üá©üá≤', 'üá©üá¥', 'üá™üá®', 'üá™üá¨', 'üá∏üáª', 'üá¨üá∂', 'üá™üá∑', 'üá™üá™', 'üá™üáπ', 'üá´üá∞', 'üá´üá¥', 'üá´üáØ', 'üá´üáÆ', 'üá´üá∑', 'üá¨üá´', 'üáµüá´', 'üáπüá´', 'üá¨üá¶', 'üá¨üá≤', 'üá¨üá™', 'üá©üá™', 'üá¨üá≠', 'üá¨üáÆ', 'üá¨üá∑', 'üá¨üá±', 'üá¨üá©', 'üá¨üáµ', 'üá¨üá∫', 'üá¨üáπ', 'üá¨üá¨', 'üá¨üá≥', 'üá¨üáº', 'üá¨üáæ', 'üá≠üáπ', 'üá≠üá≥', 'üá≠üá∞', 'üá≠üá∫', 'üáÆüá∏', 'üáÆüá≥', 'üáÆüá©', 'üáÆüá∑', 'üáÆüá∂', 'üáÆüá™', 'üáÆüá≤', 'üáÆüá±', 'üáÆüáπ', 'üá®üáÆ', 'üáØüá≤', 'üáØüáµ', 'üáØüá™', 'üáØüá¥', 'üá∞üáø', 'üá∞üá™', 'üá∞üáÆ', 'üáΩüá∞', 'üá∞üáº', 'üá∞üá¨', 'üá±üá¶', 'üá±üáª', 'üá±üáß', 'üá±üá∏', 'üá±üá∑', 'üá±üáæ', 'üá±üáÆ', 'üá±üáπ', 'üá±üá∫', 'üá≤üá¥', 'üá≤üá∞', 'üá≤üá¨', 'üá≤üáº', 'üá≤üáæ', 'üá≤üáª', 'üá≤üá±', 'üá≤üáπ', 'üá≤üá≠', 'üá≤üá∂', 'üá≤üá∑', 'üá≤üá∫', 'üáæüáπ', 'üá≤üáΩ', 'üá´üá≤', 'üá≤üá©', 'üá≤üá®', 'üá≤üá≥', 'üá≤üá™', 'üá≤üá∏', 'üá≤üá¶', 'üá≤üáø', 'üá≤üá≤', 'üá≥üá¶', 'üá≥üá∑', 'üá≥üáµ', 'üá≥üá±', 'üá≥üá®', 'üá≥üáø', 'üá≥üáÆ', 'üá≥üá™', 'üá≥üá¨', 'üá≥üá∫', 'üá≥üá´', 'üá∞üáµ', 'üá≤üáµ', 'üá≥üá¥', 'üá¥üá≤', 'üáµüá∞', 'üáµüáº', 'üáµüá∏', 'üáµüá¶', 'üáµüá¨', 'üáµüáæ', 'üáµüá™', 'üáµüá≠', 'üáµüá≥', 'üáµüá±', 'üáµüáπ', 'üáµüá∑', 'üá∂üá¶', 'üá∑üá™', 'üá∑üá¥', 'üá∑üá∫', 'üá∑üáº', 'üáßüá±', 'üá∏üá≠', 'üá∞üá≥', 'üá±üá®', 'üáµüá≤', 'üáªüá®', 'üáºüá∏', 'üá∏üá≤', 'üá∏üáπ', 'üá∏üá¶', 'üá∏üá≥', 'üá∑üá∏', 'üá∏üá®', 'üá∏üá±', 'üá∏üá¨', 'üá∏üáΩ', 'üá∏üá∞', 'üá∏üáÆ', 'üá¨üá∏', 'üá∏üáß', 'üá∏üá¥', 'üáøüá¶', 'üá∞üá∑', 'üá∏üá∏', 'üá™üá∏', 'üá±üá∞', 'üá∏üá©', 'üá∏üá∑', 'üá∏üáø', 'üá∏üá™', 'üá®üá≠', 'üá∏üáæ', 'üáπüáº', 'üáπüáØ', 'üáπüáø', 'üáπüá≠', 'üáπüá±', 'üáπüá¨', 'üáπüá∞', 'üáπüá¥', 'üáπüáπ', 'üáπüá≥', 'üáπüá∑', 'üáπüá≤', 'üáπüá®', 'üáπüáª', 'üá∫üá¨', 'üá∫üá¶', 'üá¶üá™', 'üá¨üáß', 'üá∫üá∏', 'üá∫üáæ', 'üá∫üáø', 'üáªüá∫', 'üáªüá¶', 'üáªüá™', 'üáªüá≥', 'üáªüáÆ', 'üáºüá´', 'üá™üá≠', 'üáæüá™', 'üáøüá≤', 'üáøüáº']
        };
        
        // Populate emoji grids
        function populateEmojiGrids() {
            Object.keys(emojiCategories).forEach(category => {
                const grid = document.getElementById(category);
                if (grid) {
                    emojiCategories[category].forEach(emoji => {
                        const emojiDiv = document.createElement('div');
                        emojiDiv.className = 'avatar-emoji';
                        emojiDiv.textContent = emoji;
                        emojiDiv.onclick = () => selectAvatar(emoji);
                        grid.appendChild(emojiDiv);
                    });
                }
            });
        }
        
        // Initialize emoji grids on page load
        populateEmojiGrids();
        
        // Toggle avatar selector
        function toggleAvatarSelector() {
            const selector = document.getElementById('avatarSelector');
            selector.classList.toggle('show');
        }
        
        // Select avatar
        function selectAvatar(emoji) {
            selectedAvatar = emoji;
            document.getElementById('selectedAvatar').textContent = emoji;
            document.getElementById('avatarSelector').classList.remove('show');
            // Save to localStorage
            localStorage.setItem('userAvatar', emoji);
        }
        
        // Load saved avatar
        const savedAvatar = localStorage.getItem('userAvatar');
        if (savedAvatar) {
            selectedAvatar = savedAvatar;
            document.getElementById('selectedAvatar').textContent = savedAvatar;
        }
        
        // Set username and join chat
        function setUsername() {
            const input = document.getElementById('usernameInput');
            const name = input.value.trim();
            
            if (name) {
                username = name;
                document.getElementById('usernameSetup').classList.add('hidden');
                document.getElementById('chatInputArea').classList.remove('hidden');
                // Setup message input listeners when chat area becomes visible
                setupMessageInputListeners();
                document.getElementById('messageInput').focus();
            }
        }
        
        // Send message
        function sendMessage() {
            if (!socket) {
                alert('Connection not ready. Please wait a moment and try again.');
                console.error('Socket not initialized yet');
                // Try to initialize socket again
                initializeSocket();
                return;
            }
            
            // Check if socket is connected
            if (!socket.connected) {
                alert('Not connected to server. Please wait for connection...');
                console.error('Socket not connected');
                return;
            }
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message && username) {
                try {
                    socket.emit('message', {
                        username: username,
                        avatar: selectedAvatar,
                        message: message
                    });
                    input.value = '';
                    socket.emit('typing', { username: username, isTyping: false });
                } catch (error) {
                    console.error('Error sending message:', error);
                    alert('Error sending message. Please try again.');
                }
            } else if (!username) {
                alert('Please enter a username first.');
            }
        }
        
        // Display message
        function displayMessage(message) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const time = new Date(message.timestamp).toLocaleTimeString();
            const avatar = message.avatar || 'üë§';
            
            // Create avatar element separately to ensure emoji renders
            const avatarSpan = document.createElement('span');
            avatarSpan.className = 'message-avatar';
            avatarSpan.textContent = avatar;
            
            // Create username span
            const usernameSpan = document.createElement('span');
            usernameSpan.className = 'message-username';
            usernameSpan.appendChild(avatarSpan);
            usernameSpan.appendChild(document.createTextNode(escapeHtml(message.username)));
            
            // Create time span
            const timeSpan = document.createElement('span');
            timeSpan.className = 'message-time';
            timeSpan.textContent = time;
            
            // Create header
            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            headerDiv.appendChild(usernameSpan);
            headerDiv.appendChild(timeSpan);
            
            // Create content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = message.message;
            
            // Assemble message
            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            
            messagesDiv.appendChild(messageDiv);
        }
        
        // Scroll to bottom
        function scrollToBottom() {
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Handle Enter key for username input
        const usernameInput = document.getElementById('usernameInput');
        if (usernameInput) {
            usernameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') setUsername();
            });
        }
        
        // Theme functionality
        function toggleThemeDropdown() {
            const dropdown = document.getElementById('themeDropdown');
            dropdown.classList.toggle('show');
        }
        
        function changeTheme(themeName) {
            // Remove all theme classes
            const bodyClasses = document.body.className.split(' ').filter(cls => !cls.startsWith('theme-'));
            document.body.className = bodyClasses.join(' ');
            
            // Add new theme class
            if (themeName !== 'default') {
                document.body.classList.add('theme-' + themeName);
            }
            
            // Save to localStorage
            localStorage.setItem('chatTheme', themeName);
            
            // Close dropdown if it exists
            const dropdown = document.getElementById('themeDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
        
        // Load saved theme on page load
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('chatTheme');
            if (savedTheme) {
                changeTheme(savedTheme);
            }
        }
        
        // Load theme immediately (script is at bottom, so DOM is ready)
        loadSavedTheme();
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            // Close theme dropdown
            const themeDropdown = document.getElementById('themeDropdown');
            const themeButton = document.querySelector('.theme-button');
            if (themeDropdown && !themeDropdown.contains(e.target) && themeButton && !themeButton.contains(e.target)) {
                themeDropdown.classList.remove('show');
            }
            
            // Close avatar selector
            const avatarSelector = document.getElementById('avatarSelector');
            const selectedAvatar = document.getElementById('selectedAvatar');
            if (avatarSelector && !avatarSelector.contains(e.target) && selectedAvatar && !selectedAvatar.contains(e.target)) {
                avatarSelector.classList.remove('show');
            }
        });
    </script>
</body>
</html>
